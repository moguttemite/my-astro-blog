---
import PageLayout from '../layouts/PageLayout.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

import type { FeedItemCardModel } from '../type'; // 按你的实际路径
import { getCollection } from 'astro:content';
const posts = await getCollection('blog');
const feedItems: FeedItemCardModel[] = posts
  .sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime())
  .map((post) => {
    const body = (post.body ?? '').trim();
    const excerpt = body.split('\n').find(Boolean) ?? '';

    return {
      id: post.id,
      publishedAt: post.data.publishedAt.toISOString().slice(0, 10),
      title: post.data.title,
      excerpt,
      url: `/blog/${post.id}/`,
    };
  });
---

<PageLayout title={SITE_TITLE}, description={SITE_DESCRIPTION}>
	<section class="feed">
		{feedItems.map((item) => (
			<article class="feed-card">
				<div class="feed-meta">
					<time class="feed-time">{item.publishedAt}</time>
				</div>
				<h2 class="feed-title">
					<a href={item.url}>{item.title}</a>
				</h2>
				<p class="feed-excerpt">{item.excerpt}</p>
			</article>
		))}
	</section>
</PageLayout>

<style>
	.feed {
		max-width: 820px;
		margin: 0 auto;
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.feed-card {
		background: white;
		border-radius: 8px;
		border: 1px solid rgb(var(--gray-light));
		padding: 1.5rem;
		box-shadow: 0 1px 3px rgba(var(--black), 5%);
		transition: border-color 0.2s ease;
	}
	:root[data-theme="dark"] .feed-card {
		background-color: #2f3232;
		border: 1px solid rgba(255, 255, 255, 0.06);
		box-shadow: none;
	}
	:root[data-theme="dark"] .feed-card:hover {
		border-color: rgba(255, 255, 255, 0.12);
	}

	.feed-meta {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		margin-bottom: 0.75rem;
		font-size: 0.875rem;
		color: rgb(var(--gray));
	}
	:root[data-theme="dark"] .feed-meta {
		color: #9da7b3;
	}

	.feed-time {
		color: rgb(var(--gray));
	}
	:root[data-theme="dark"] .feed-time {
		color: #7d8590;
	}

	.feed-title {
		margin: 0 0 0.75rem 0;
		font-size: 1.25rem;
		line-height: 1.4;
		color: rgb(var(--black));
		font-weight: 600;
	}
	:root[data-theme="dark"] .feed-title {
		color: #e6edf3;
	}
	:root[data-theme="dark"] .feed-title a {
		color: #58a6ff;
	}

	.feed-excerpt {
		margin: 0 0 1rem 0;
		color: rgb(var(--gray-dark));
		line-height: 1.6;
		font-size: 0.9375rem;
	}
	:root[data-theme="dark"] .feed-excerpt {
		color: #9da7b3;
	}

	@media (max-width: 720px) {
		.feed {
			gap: 1.25rem;
		}

		.feed-card {
			padding: 1.25rem;
		}

		.feed-title {
			font-size: 1.125rem;
		}
	}
</style>
