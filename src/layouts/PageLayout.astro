---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description?: string;
  /** 仅根路径首页传 true：在 head 中注入脚本，按 Accept-Language 在首访 / 时重定向到 /ja/ 或 /en/（定稿 §2） */
  injectRedirectScript?: boolean;
}
const { title, description = '', injectRedirectScript = false } = Astro.props;

// i18n: 根据 Astro.currentLocale 输出 <html lang="...">，与 astro.config.mjs 的 locales 一致
const localeToLang: Record<string, string> = {
  zh: 'zh-CN',
  ja: 'ja',
  en: 'en',
};
const currentLocale = Astro.currentLocale ?? 'zh';
const htmlLang = localeToLang[currentLocale] ?? 'zh-CN';
---

<!doctype html>
<html lang={htmlLang}>
  <head>
    <BaseHead title={title} description={description} />
    {injectRedirectScript && (
      <script is:inline>
        (function () {
          var path = window.location.pathname.replace(/\/$/, '') || '/';
          if (path !== '/') return;
          var ref = typeof document !== 'undefined' ? (document.referrer || '') : '';
          var origin = typeof location !== 'undefined' ? (location.origin || '') : '';
          if (ref.length > 0 && origin.length > 0 && ref.indexOf(origin) === 0) return;
          var lang = (navigator.language || navigator.userLanguage || '').toLowerCase();
          if (lang.indexOf('ja') === 0) { window.location.replace('/ja/'); return; }
          if (lang.indexOf('en') === 0) { window.location.replace('/en/'); return; }
        })();
      </script>
    )}
  </head>

  <body>
    <Header />

    <main class="page-content">
      <slot />
    </main>

    <Footer />
  </body>
</html>

<style>
  .page-content {
    width: 100%;
    max-width: 1040px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem;
  }

  @media (max-width: 720px) {
    .page-content {
      padding: 1.5rem 1rem;
    }
  }
</style>
